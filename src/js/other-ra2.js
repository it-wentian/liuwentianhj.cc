const GITHUB_DATA_URL="https://raw.githubusercontent.com/it-wentian/ra2_versions/main/ra2_versions.json",gridContainer=document.getElementById("ra2Grid"),filterButtons=document.querySelectorAll(".filter-btn"),searchInput=document.getElementById("searchRa2"),loadMoreBtn=document.getElementById("loadMoreBtn"),noResults=document.getElementById("noResults"),resetSearchBtn=document.getElementById("resetSearch");let originalRa2Versions=[],filteredRa2Versions=[],currentPage=1;const itemsPerPage=4;let isLoading=!1;function showLoading(){isLoading=!0,gridContainer.innerHTML='\n            <div class="col-span-full flex justify-center py-16">\n                <div class="flex flex-col items-center">\n                    <div class="w-12 h-12 border-4 border-militaryAccent/30 border-t-militaryAccent rounded-full animate-spin"></div>\n                    <p class="mt-4 text-light">加载红警版本数据中...</p>\n                </div>\n            </div>\n        '}function showError(e){gridContainer.innerHTML=`\n            <div class="col-span-full flex justify-center py-16">\n                <div class="flex flex-col items-center text-center">\n                    <i class="fa fa-exclamation-triangle text-yellow-500 text-4xl mb-4"></i>\n                    <p class="text-light mb-2">${e}</p>\n                    <button id="retryBtn" class="mt-4 bg-militaryAccent hover:bg-militaryAccent/80 text-white px-4 py-2 rounded transition-colors">\n                        重试加载\n                    </button>\n                </div>\n            </div>\n        `,document.getElementById("retryBtn").addEventListener("click",fetchRa2Data)}async function fetchRa2Data(){showLoading();try{const e=await fetch(GITHUB_DATA_URL);if(!e.ok)throw new Error(`请求失败 (${e.status})`);const t=await e.json();if(!(Array.isArray(t)&&t.length>0))throw new Error("获取的数据格式不正确");originalRa2Versions=t,filteredRa2Versions=[...originalRa2Versions],currentPage=1,renderPaginatedVersions()}catch(e){console.error("加载数据失败:",e),showError(`数据加载失败：${e.message}<br>请检查网络或稍后重试`)}}function createDocumentFragment(e){const t=document.createDocumentFragment();return e.forEach(e=>{const n=document.createElement("div");n.className="ra2-item bg-militaryMedium/70 rounded-lg overflow-hidden border border-militaryAccent/30 card-hover super-glow fade-in",n.dataset.category=e.category,n.dataset.id=e.id,n.innerHTML=`\n                <div class="relative h-48 overflow-hidden">\n                    <img src="${e.image}" alt="${e.title}" \n                        class="w-full h-full object-cover transition-transform duration-500 hover:scale-110" \n                        loading="lazy" \n                        onerror="this.src='https://picsum.photos/400/300?random=${e.id}'">\n                    <div class="absolute top-3 right-3 ${e.badgeColor} text-white text-xs font-bold px-2 py-1 rounded">\n                        ${e.badge}\n                    </div>\n                </div>\n                <div class="p-5">\n                    <h3 class="text-xl font-bold text-white mb-2">${e.title}</h3>\n                    <p class="text-light text-sm mb-4">${e.description}</p>\n                    <div class="flex justify-between items-center">\n                        <div class="text-sm text-light">\n                            <span class="mr-3"><i class="fa fa-calendar mr-1"></i> ${e.year}</span>\n                            <span> <i class="fa fa-tag mr-1"></i>${e.version}</span>\n                        </div>\n                        <a href="${e.downloadUrl}" target="_blank"'}\n                            class="bg-militaryAccent hover:bg-militaryAccent/80 text-white px-3 py-1 rounded text-sm transition-colors flex items-center">\n                            <i class="fa fa-download mr-1"></i> 下载\n                        </a>\n                    </div>\n                </div>\n            `,t.appendChild(n)}),t}function renderPaginatedVersions(){const e=4*(currentPage-1),t=e+4,n=filteredRa2Versions.slice(e,t);if(1===currentPage&&(gridContainer.innerHTML=""),n.length>0){const e=createDocumentFragment(n);gridContainer.appendChild(e),noResults.classList.add("hidden"),loadMoreBtn.classList.remove("hidden"),t>=filteredRa2Versions.length?(loadMoreBtn.innerHTML='<i class="fa fa-check mr-2"></i> 已加载全部内容',loadMoreBtn.disabled=!0,loadMoreBtn.classList.add("opacity-70","cursor-not-allowed")):(loadMoreBtn.innerHTML='<i class="fa fa-refresh mr-2 transition-transform duration-500 hover:rotate-180"></i> 加载更多',loadMoreBtn.disabled=!1,loadMoreBtn.classList.remove("opacity-70","cursor-not-allowed"))}else 1===currentPage&&(noResults.classList.remove("hidden"),loadMoreBtn.classList.add("hidden"));isLoading=!1}let currentFilter="all",currentSearchTerm="";function filterAndRender(){if(filteredRa2Versions=[...originalRa2Versions],"all"!==currentFilter&&(filteredRa2Versions=filteredRa2Versions.filter(e=>e.category===currentFilter)),currentSearchTerm){const e=currentSearchTerm.toLowerCase();filteredRa2Versions=filteredRa2Versions.filter(t=>t.title.toLowerCase().includes(e)||t.description.toLowerCase().includes(e)||t.version.toLowerCase().includes(e))}currentPage=1,renderPaginatedVersions(),0===filteredRa2Versions.length?(noResults.classList.remove("hidden"),loadMoreBtn.classList.add("hidden")):(noResults.classList.add("hidden"),loadMoreBtn.classList.remove("hidden"))}function initEvents(){let e;filterButtons.forEach(e=>{e.addEventListener("click",()=>{filterButtons.forEach(t=>{t.classList.toggle("active",t===e),t.classList.toggle("bg-militaryAccent",t===e),t.classList.toggle("bg-militaryDark",t!==e),t.classList.toggle("hover:bg-militaryAccent/80",t!==e)}),currentFilter=e.dataset.filter,filterAndRender()})}),searchInput.addEventListener("input",()=>{clearTimeout(e),e=setTimeout(()=>{currentSearchTerm=searchInput.value.trim(),filterAndRender()},300)}),loadMoreBtn.addEventListener("click",()=>{isLoading||4*currentPage>=filteredRa2Versions.length||(isLoading=!0,currentPage++,renderPaginatedVersions())}),resetSearchBtn.addEventListener("click",()=>{searchInput.value="",currentSearchTerm="",currentFilter="all",filterButtons.forEach(e=>{e.classList.toggle("active","all"===e.dataset.filter),e.classList.toggle("bg-militaryAccent","all"===e.dataset.filter),e.classList.toggle("bg-militaryDark","all"!==e.dataset.filter),e.classList.toggle("hover:bg-militaryAccent/80","all"!==e.dataset.filter)}),filterAndRender()});const t=document.getElementById("mobileMenuBtn"),n=document.getElementById("mobileMenu");t&&n&&t.addEventListener("click",()=>{n.classList.toggle("hidden")});const r=document.getElementById("backBtn");r&&r.addEventListener("click",()=>{window.history.back()})}document.addEventListener("DOMContentLoaded",()=>{initEvents(),fetchRa2Data()});