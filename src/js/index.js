  const mainNav=document.getElementById("mainNav");window.addEventListener("scroll",()=>{window.scrollY>50?(mainNav.classList.add("py-2"),mainNav.classList.remove("py-3")):(mainNav.classList.add("py-3"),mainNav.classList.remove("py-2"))});const menuBtn=document.getElementById("menuBtn"),mobileMenu=document.getElementById("mobileMenu");menuBtn.addEventListener("click",()=>{mobileMenu.classList.toggle("hidden")});const loginBtn=document.getElementById("loginBtn"),mobileLoginBtn=document.getElementById("mobileLoginBtn"),loginModal=document.getElementById("loginModal"),closeLoginModal=document.getElementById("closeLoginModal"),modalOverlay=document.getElementById("modalOverlay");function openLoginModal(){loginModal.classList.remove("hidden"),document.body.style.overflow="hidden"}function closeLoginModalFunc(){loginModal.classList.add("hidden"),document.body.style.overflow=""}loginBtn.addEventListener("click",openLoginModal),mobileLoginBtn.addEventListener("click",openLoginModal),closeLoginModal.addEventListener("click",closeLoginModalFunc),modalOverlay.addEventListener("click",closeLoginModalFunc);const playTrailer=document.getElementById("playTrailer"),videoModal=document.getElementById("videoModal"),closeVideoModal=document.getElementById("closeVideoModal"),videoModalOverlay=document.getElementById("videoModalOverlay"),trailerVideo=document.getElementById("trailerVideo"),fullscreenBtn=document.getElementById("fullscreenBtn");function openVideoModal(){videoModal.classList.remove("hidden"),document.body.style.overflow="hidden";const e=trailerVideo.src;trailerVideo.src=e+"&autoplay=1"}function closeVideoModalFunc(){videoModal.classList.add("hidden"),document.body.style.overflow="",trailerVideo.src=trailerVideo.src.split("&autoplay=1")[0]}function toggleFaq(e){const t=e.nextElementSibling,n=e.querySelector("i");document.querySelectorAll(".faq-toggle").forEach(t=>{const n=t.nextElementSibling,a=t.querySelector("i");t!==e&&(n.classList.add("hidden"),a&&(a.style.transform="rotate(0deg)"))}),t.classList.toggle("hidden"),n.style.transform=t.classList.contains("hidden")?"rotate(0deg)":"rotate(180deg)"}fullscreenBtn.addEventListener("click",()=>{const e=trailerVideo.parentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}),playTrailer.addEventListener("click",openVideoModal),closeVideoModal.addEventListener("click",closeVideoModalFunc),videoModalOverlay.addEventListener("click",closeVideoModalFunc),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault(),mobileMenu.classList.contains("hidden")||mobileMenu.classList.add("hidden");const t=this.getAttribute("href");if("#"===t)return;const n=document.querySelector(t);n&&window.scrollTo({top:n.offsetTop-80,behavior:"smooth"})})});const carouselData=[{imageUrl:"https://s2.loli.net/2025/07/22/hY4PRJS3KBFk9fw.png",altText:"木箱防守 - 非常好玩的模式",title:"木箱防守模式",description:"开局一个超级要塞，装备全靠开箱",icon:"fa-industry"},{imageUrl:"https://s2.loli.net/2025/07/22/tmUOkH5FG1ohV4X.png",altText:"DTA - 全新的界面",title:"全新的界面",description:"设置从这里开始，还可以掀开教程",icon:"fa-building"},{imageUrl:"https://s2.loli.net/2025/07/22/FAjbUsVK76DRB8G.png",altText:"DTA - 丰富的模式和复选框组件",title:"丰富的DTA设置",description:"高度的可配置化设置，让游戏变得随心所欲",icon:"fa-crosshairs"},{imageUrl:"https://s2.loli.net/2025/07/22/klxT35KuVsMSjRq.png",altText:"单兵服务 - 打造自己的初始防守系统",title:"单兵服务",description:"开局就能自定义个人超级单位，爽就从这里开始",icon:"fa-fort-awesome"},{imageUrl:"https://s2.loli.net/2024/11/06/QqOZunWUwH2hoCK.png",altText:"防守图 - 花样防守",title:"600+防守",description:"各种类型的防守图，玩到无从选择",icon:"fa-ship"},{imageUrl:"https://s2.loli.net/2024/09/15/8gas4J6TmqYoSzn.png",altText:"美国 - 具有全球战略核打击能力",title:"B2幽灵隐身轰炸机",description:"美国专属隐藏单位，窃取苏盟科技，即可展开斩首行动",icon:"fa-bolt"}];function initCarousel(){const e=document.getElementById("carouselTrack"),t=document.getElementById("carouselIndicators"),n=document.getElementById("prevBtn"),a=document.getElementById("nextBtn"),l=e.parentElement,i=carouselData.length,o=window.innerWidth<768?1:2;let r=o,s=!1;function c(){e.innerHTML="";const t=l.offsetWidth/o;for(let n=i-o;n<i;n++){const a=d(carouselData[n],t);a.classList.add("cloned"),e.appendChild(a)}carouselData.forEach(n=>{const a=d(n,t);e.appendChild(a)});for(let n=0;n<o;n++){const a=d(carouselData[n],t);a.classList.add("cloned"),e.appendChild(a)}}function d(e,t){const n=document.createElement("div");return n.style.width=`${t}px`,n.style.flexShrink="0",n.style.padding="0 8px",n.innerHTML=`\n            <div class="game-screenshot relative group overflow-hidden rounded-xl shadow-2xl border border-militaryAccent/30 transition-all duration-300 hover:shadow-militaryAccent/20 hover:shadow-xl h-full">\n                \x3c!-- 使用object-contain确保图片完整显示，不被切割 --\x3e\n                <img src="${e.imageUrl}" alt="${e.altText}"\n                    class="w-full h-[60vh] md:h-[50vh] object-contain transition-transform duration-700 group-hover:scale-105 bg-militaryDark/50">\n                <div class="absolute inset-0 bg-gradient-to-t from-militaryDark/90 via-militaryDark/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end">\n                    <div class="p-6">\n                        <h3 class="text-xl font-bold text-white flex items-center">\n                            <i class="fa ${e.icon} text-militaryAccent mr-2"></i>${e.title}\n                        </h3>\n                        <p class="text-light mt-2">${e.description}</p>\n                    </div>\n                </div>\n            </div>\n        `,n}function m(){t.innerHTML="";for(let e=0;e<i;e++){const n=document.createElement("button");n.className="carousel-indicator w-3 h-3 rounded-full mx-1 transition-all duration-300 "+(0===e?"bg-militaryAccent":"bg-white/30"),n.setAttribute("data-index",e),n.addEventListener("click",()=>{s||g(e+o)}),t.appendChild(n)}}function u(t=!0){e.style.transition=t?"transform 500ms ease-out":"none";const n=l.offsetWidth/o,a=r*n;e.style.transform=`translateX(-${a}px)`,function(){let e=(r-o)%i;e<0&&(e+=i);document.querySelectorAll(".carousel-indicator").forEach((t,n)=>{n===e?(t.classList.add("bg-militaryAccent"),t.classList.remove("bg-white/30")):(t.classList.remove("bg-militaryAccent"),t.classList.add("bg-white/30"))})}(),s=!0,t?setTimeout(()=>{r>=i+o?(r=o,u(!1)):r<o&&(r=i,u(!1)),s=!1},500):s=!1}function g(e){s||(r=e,u())}a.addEventListener("click",()=>{s||g(r+1)}),n.addEventListener("click",()=>{s||g(r-1)}),window.addEventListener("resize",()=>{const e=window.innerWidth<768?1:2;e!==o?(c(),r=e,u(!1),m()):(c(),u(!1))});let p=setInterval(()=>{s||a.click()},5e3);l.addEventListener("mouseenter",()=>{clearInterval(p)}),l.addEventListener("mouseleave",()=>{p=setInterval(()=>{s||a.click()},5e3)}),l.style.overflow="hidden",l.style.position="relative",e.style.display="flex",e.style.width="100%",e.style.transition="transform 500ms ease-out",c(),m(),u(!1)}let playerData=[],filteredData=[],currentPage=1;const itemsPerPage=5,playerList=document.getElementById("player-list"),paginationNumbers=document.getElementById("pagination-numbers"),prevPageBtn=document.getElementById("prev-page"),nextPageBtn=document.getElementById("next-page"),startItem=document.getElementById("start-item"),endItem=document.getElementById("end-item"),totalItems=document.getElementById("total-items");function createPlayerCard(e){const t=document.createElement("div");t.className="p-5 hover:bg-militaryAccent/10 transition-colors duration-300";const n=document.createElement("div");n.className="flex";const a=document.createElement("div");a.className="mr-4";const l=document.createElement("img");l.src=e.qq_avatar,l.alt=`${e.fullName}头像`,l.className="w-16 h-16 rounded-full object-cover border-2 border-militaryAccent";const i=document.createElement("div");i.className="mt-2 text-center";const o=document.createElement("span");o.className=`inline-block ${{"终身卡":"bg-yellow-500/20 text-yellow-500","三年卡":"bg-red-500/20 text-red-500","一年卡":"bg-pink-500/20 text-pink-400","半年卡":"bg-blue-500/20 text-blue-400","月卡":"bg-green-500/20 text-green-400"}[e.package]||"bg-gray-500/20 text-gray-300"} px-2 py-1 rounded text-xs font-bold`,o.textContent=e.package,i.appendChild(o),a.appendChild(l),a.appendChild(i);const r=document.createElement("div");r.className="flex-1";const s=document.createElement("div");s.className="flex justify-between";const c=document.createElement("div"),d=document.createElement("h4");d.className="font-bold text-white text-xl",d.textContent=e.fullName;const m=document.createElement("p");m.className="text-light text-sm mt-1",m.textContent=`会员ID: ${e.userName}`,c.appendChild(d),c.appendChild(m);const u=document.createElement("div"),g=document.createElement("div");g.className="text-militaryAccent font-bold",g.textContent="到期时间";const p=document.createElement("div");p.className="text-light text-sm",p.textContent=e.expiryTime.split(" ")[0],u.appendChild(g),u.appendChild(p),s.appendChild(c),s.appendChild(u);const h=document.createElement("div");h.className="flex flex-wrap justify-between mt-4 gap-2";const f=document.createElement("div");return f.className="flex items-center",f.innerHTML=`<span class="text-light text-sm"><i class="fa fa-calendar mr-1"></i> ${e.time.split(" ")[0]} 加入</span>`,h.appendChild(f),r.appendChild(s),r.appendChild(h),n.appendChild(a),n.appendChild(r),t.appendChild(n),t}function renderPlayerList(){playerList.innerHTML="";const e=5*(currentPage-1),t=e+5,n=filteredData.slice(e,t);0===n.length?playerList.innerHTML='\n            <div class="p-8 text-center">\n                <i class="fa fa-search text-4xl text-militaryAccent/50 mb-4"></i>\n                <p class="text-light">没有找到匹配的会员</p>\n            </div>':n.forEach(e=>{playerList.appendChild(createPlayerCard(e))}),startItem.textContent=filteredData.length?e+1:0,endItem.textContent=Math.min(t,filteredData.length),totalItems.textContent=filteredData.length,updatePaginationButtons()}function updatePaginationButtons(){const e=Math.ceil(filteredData.length/5);paginationNumbers.innerHTML="";let t=Math.max(1,currentPage-3),n=Math.min(e,t+6);n-t<6&&t>1&&(t=Math.max(1,n-6)),t>1&&(addPageButton(1),t>2&&addEllipsis());for(let e=t;e<=n;e++)addPageButton(e);n<e&&(n<e-1&&addEllipsis(),addPageButton(e)),prevPageBtn.disabled=1===currentPage,nextPageBtn.disabled=currentPage===e}function addPageButton(e){const t=document.createElement("button");t.className="w-8 h-8 rounded flex items-center justify-center "+(e===currentPage?"bg-militaryAccent text-white":"bg-militaryDark/80 hover:bg-militaryAccent transition-colors"),t.textContent=e,t.addEventListener("click",()=>{currentPage=e,renderPlayerList()}),paginationNumbers.appendChild(t)}function addEllipsis(){const e=document.createElement("span");e.className="w-8 h-8 flex items-center justify-center text-light",e.textContent="...",paginationNumbers.appendChild(e)}function setupSearchFilter(){document.getElementById("search-input").addEventListener("input",function(){const e=this.value.toLowerCase();filteredData=playerData.filter(t=>t.fullName.toLowerCase().includes(e)||t.userName.toLowerCase().includes(e)||t.email.toLowerCase().includes(e)),currentPage=1,renderPlayerList()}),document.getElementById("filter-select").addEventListener("change",function(){const e=this.value;filteredData="all"===e?[...playerData]:playerData.filter(t=>t.package===e),currentPage=1,renderPlayerList()})}function setupPaginationControls(){prevPageBtn.addEventListener("click",()=>{currentPage>1&&(currentPage--,renderPlayerList())}),nextPageBtn.addEventListener("click",()=>{currentPage<Math.ceil(filteredData.length/5)&&(currentPage++,renderPlayerList())})}function initChart(e){const t={};e.forEach(e=>{t[e.package]=(t[e.package]||0)+1});const n=Object.keys(t).map(e=>({name:e,value:t[e]})),a=echarts.init(document.getElementById("chart-container")),l={backgroundColor:"rgba(0, 0, 0, 0)",title:{text:"会员套餐分布",subtext:"基于套餐类型",left:"center",textStyle:{color:"#fff"},subtextStyle:{color:"#ccc"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)",backgroundColor:"rgba(0, 0, 0, 0.7)",borderColor:"rgba(120, 162, 51, 0.5)",borderWidth:1},series:[{name:"套餐",type:"pie",radius:"50%",data:n,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},itemStyle:{borderColor:"rgba(0, 0, 0, 0.3)",borderWidth:1},label:{color:"#fff"},labelLine:{lineStyle:{color:"rgba(255, 255, 255, 0.3)"}}}]};a.setOption(l),window.addEventListener("resize",()=>a.resize())}function renderLatestUpdate(e){const t=document.getElementById("latest-update");t.innerHTML="";const n={"修复":["fa-bug","text-red-500"],"优化":["fa-cog","text-green-500"],"新增":["fa-plus-circle","text-blue-500"],"调整":["fa-sliders","text-orange-500"],"删除":["fa-trash","text-gray-400"],"更新":["fa-refresh","text-purple-500"],"改进":["fa-arrow-up","text-teal-500"],"增加":["fa-plus-circle","text-blue-500"]},a=["fa-check-circle","text-gray-400"],l=document.createElement("div");l.className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6",l.innerHTML=`\n        <div>\n            <h3 class="text-2xl md:text-3xl font-bold text-white mb-2">版本 ${e.version}</h3>\n            <p class="text-light/70">更新日期: ${e.date}</p>\n        </div>\n        <div class="mt-4 md:mt-0">\n            <span class="version-badge">最新版本</span>\n        </div>\n    `,t.appendChild(l);const i=document.createElement("div");i.className="space-y-4",i.id="changelog-content",Object.entries(e.changes||{}).forEach(([e,t],l)=>{const o=`changelog-${e.toLowerCase().replace(/\s+/g,"-")}`,r=document.createElement("div");r.className="changelog-category-container";const s=document.createElement("button");s.className="changelog-category w-full flex justify-between items-center py-3 px-4 bg-military-dark/50 hover:bg-military-dark/30 rounded-lg transition-colors",s.setAttribute("onclick",`toggleChangelog('${o}')`),s.innerHTML=`\n            <span class="font-bold text-white">${e}</span>\n            <i class="fa fa-chevron-down text-military-green transition-transform"></i>\n        `;const c=document.createElement("div");c.id=o,c.className="changelog-items hidden";const d=document.createElement("ul");d.className="space-y-2 p-4",t.forEach((e,t)=>{const l=Object.keys(n).find(t=>e.includes(t))||"",[i,o]=n[l]||a,r=document.createElement("li");r.className="changelog-item flex items-start opacity-0",r.setAttribute("data-delay",50*t),r.innerHTML=`\n                <i class="fa ${o} ${i} text-military-green mt-1 mr-3"></i>\n                <span class="text-light">${e}</span>\n            `,d.appendChild(r)}),c.appendChild(d),r.appendChild(s),r.appendChild(c),i.appendChild(r)}),t.appendChild(i);const o=document.createElement("div");o.className="mt-8 pt-6 border-t border-military-green/20",o.id="downloadItems";const r=document.createElement("h4");r.className="text-xl font-bold text-white mb-4",r.textContent="下载更新";const s=document.createElement("div");if(s.className="grid grid-cols-1 md:grid-cols-3 gap-4",e.download&&"object"==typeof e.download)Object.entries(e.download).forEach(([e,t])=>{const n=document.createElement("a");n.href=t.link,n.className="bg-military-dark hover:bg-military-dark/80 p-4 rounded-lg border border-military-green/30 transition-all duration-300 flex items-center",n.innerHTML=`\n                <div class="mr-3 text-2xl text-military-green"><i class="fa fa-cloud-download"></i></div>\n                <div>\n                    <h5 class="font-semibold text-white">${e}</h5>\n                    <p class="text-light/70 text-sm">点击下载更新包${t.code?` (提取码: ${t.code})`:""}</p>\n                </div>\n            `,s.appendChild(n)});else{const e=document.createElement("div");e.className="col-span-full bg-military-dark/50 p-4 rounded-lg border border-military-green/20 text-center",e.innerHTML='<p class="text-light/60">暂无可用的下载选项</p>',s.appendChild(e)}o.appendChild(r),o.appendChild(s),t.appendChild(o);const c=Object.keys(e.changes||{})[0];if(c){const e=`changelog-${c.toLowerCase().replace(/\s+/g,"-")}`;toggleChangelog(e)}}function animateChangelogItems(e){e.querySelectorAll(".changelog-item").forEach((e,t)=>{const n=e.dataset.delay||50*t;setTimeout(()=>{e.style.transition="opacity 0.3s ease-out",e.style.opacity="1"},n)})}window.toggleChangelog=function(e){const t=document.getElementById(e);if(!t)return;const n=t.previousElementSibling.querySelector("i");t.classList.toggle("hidden"),t.classList.contains("hidden")?n.style.transform="rotate(0deg)":(n.style.transform="rotate(180deg)",animateChangelogItems(t))};const apiCache={};async function fetchWithCache(e,t){if(apiCache[t])return apiCache[t];const n=localStorage.getItem(t),a=localStorage.getItem(`${t}_time`),l=Date.now();if(n&&a&&l-a<36e5){const e=JSON.parse(n);return apiCache[t]=e,e}const i=await fetch(e);if(!i.ok)throw new Error("Network response was not ok");const o=await i.json();return apiCache[t]=o,localStorage.setItem(t,JSON.stringify(o)),localStorage.setItem(`${t}_time`,l.toString()),o}document.addEventListener("DOMContentLoaded",async function(){try{const e="https://cdn.jsdelivr.net/gh/it-wentian/userdata@main/%E6%B3%A8%E5%86%8C%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE.json",t="https://cdn.jsdelivr.net/gh/it-wentian/version@main/bigUpdates.json",[n,a]=await Promise.all([fetchWithCache(e,"playerData"),fetchWithCache(t,"versionData")]);filteredData=[...n],playerData=[...n],initChart(playerData),renderPlayerList(),setupSearchFilter(),setupPaginationControls(),initChart(playerData),renderLatestUpdate(a),document.querySelectorAll(".faq-toggle").forEach(e=>{e.nextElementSibling?.classList.add("hidden"),e.addEventListener("click",()=>{toggleFaq(e)})})}catch(e){console.error("Fetch error:",e)}initCarousel(),document.getElementById("fulldownload").addEventListener("click",()=>{document.getElementById("downloadItems")?.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}),document.getElementById("joinQQGroup").addEventListener("click",()=>{var e;e="Wc-fXpdIZr8BCI7iRwXNIbZPXrAYbd5Z&jump_from=webapi&authKey=0vb01c1N3DLrQky9Ych98NvIWHrsg4TObWHB1nwrRLMDft271OzyuQejMCrv2LfI",window.open(`https://qm.qq.com/cgi-bin/qm/qr?k=${e}`,"_blank")})});
